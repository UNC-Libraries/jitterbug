<dataConfig>
    <dataSource driver="com.mysql.jdbc.Driver" type="JdbcDataSource"
        url="jdbc:mysql://localhost:3306/junebug" user="root" password="" />
    <document>
        <!-- this entity is the 'root' entity. -->
        <entity name="preservation_master" query="

            SELECT 
                masters.id AS id,
                masters.call_number AS call_number,
                masters.file_name AS file_name,
                masters.duration_in_seconds AS duration_in_seconds,
                masters.department_id AS department_id,
                items.collection_id AS collection_id,
                collections.name AS collection_name,
                items.format_id AS format_id,
                formats.name AS format_name,
                departments.name AS department_name,
                types.id AS type_id,
                TRIM(TRAILING 'PreservationMaster' FROM masters.masterable_type) AS type_name,
                masters.created_at AS created_at,
                masters.updated_at AS updated_at
            FROM
                preservation_masters AS masters
            LEFT JOIN audio_visual_items AS items ON
                masters.call_number = items.call_number
            LEFT JOIN collections ON
                items.collection_id = collections.id
            LEFT JOIN formats ON
                items.format_id = formats.id
            LEFT JOIN departments ON
                masters.department_id = departments.id
            LEFT JOIN media_types AS types ON
                TRIM(TRAILING 'PreservationMaster' FROM masters.masterable_type) = types.name
            WHERE
                masters.deleted_at is null;

        ">

            <field column="id" name="id" />
            <field column="call_number" name="callNumber" />
            <field column="file_name" name="fileName" />
            <field column="duration_in_seconds" name="durationInSeconds" />
            <field column="department_id" name="departmentId" />
            <field column="department_name" name="departmentName" />
            <field column="collection_id" name="collectionId" />
            <field column="collection_name" name="collectionName" />
            <field column="format_id" name="formatId" />
            <field column="format_name" name="formatName" />
            <field column="type_id" name="typeId" />
            <field column="type_name" name="typeName" />
            <field column="created_at" name="createdAt" />
            <field column="updated_at" name="updatedAt" />

            <entity name="cut" query="

                SELECT
                    id,
                    performer_composer,
                    title
                FROM
                    cuts
                WHERE
                    call_number='${preservation_master.call_number}' ">

                <field column="id" name="cutIds" />
                <field column="performer_composer" name="cutPerformerComposers" />
                <field column="title" name="cutTitles" />

            </entity>

        </entity>
    </document>
</dataConfig>
